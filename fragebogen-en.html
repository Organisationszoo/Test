<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fragebogen mit Tierprofil</title>
  <!-- Open Sans einbinden statt Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Plugin für Prozentwerte im Diagramm -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    /* Basis-Styling */
    body {
      font-family: 'Open Sans', sans-serif;
      margin: 0 auto;
      padding: 0 20px 40px;
      max-width: 960px;
      background: #f5f5f5;
      color: #2c2c2c; /* neutraler, gut lesbarer Text */
    }
    h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #1a1a1a;
      text-align: center;
      margin-top: 60px;
      margin-bottom: 20px;
      letter-spacing: 0.3px;
    }
    .user-inputs {
      margin-bottom: 30px;
    }
    .user-inputs input {
      padding: 10px;
      width: 100%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
    }
    #result-footer {
      display: none;
    }
    .user-inputs label {
      font-weight: bold;
      color: #333;
    }

    /* Logo, Header und Beschreibung */
    .logo-wrapper {
      text-align: center;
    }
    /* OrganisationsZoo-Text ausblenden */
    .logo-wrapper .organisationszoo {
      display: none !important;
    }
    /* Eule ohne kreisförmigen Zuschnitt */
    .logo-wrapper .eule,
    #result-header img {
      display: block;
      margin: 0 auto;
      width: 200px;       /* gewünschte Breite; anpassen, falls nötig */
      height: 200px;      /* gleiche Höhe für einen quadratischen Bereich */
      object-fit: cover;  /* sorgt dafür, dass das Bild vollständig angezeigt wird */
      border-radius: 0;   /* kein runder Zuschnitt */
      background-color: #ffffff;
      border: none;
    }
    .logo-container {
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      background-color: #ffffff;
      padding: 40px 0;
      box-sizing: border-box;
    }
    .logo-background {
      background-color: #ffffff;
      padding: 30px 0;
    }
    .beschreibung {
      max-width: 800px;
      margin: 40px auto;
      font-size: 1.1em;
      line-height: 1.7;
      color: #2c2c2c;
      text-align: center;
    }
    .beschreibung h2 {
      font-size: 1.6em;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 20px;
    }
    .beschreibung .highlight {
      color: #E44A00;
      font-weight: bold;
    }

    /* Dark Mode */
    @media (prefers-color-scheme: dark) {
      .beschreibung {
        color: #f0f0f0;
      }
      .beschreibung h2 {
        color: #ffffff;
      }
      .beschreibung .highlight {
        color: #E44A00;
      }
    }
    /* Light Mode (Standard) */
    h2 {
      color: #000; /* oder dein Standard-Dunkelblau */
    }
    /* Dark Mode */
    @media (prefers-color-scheme: dark) {
      h2 {
        color: #ffffff; /* Willkommens-Text in Weiss */
      }
      .highlight {
        color: #E44A00; /* OrganisationsZoo bleibt orange */
      }
    }
    .intro-section {
      background-color: #ffffff;
      padding: 40px 20px;
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      box-sizing: border-box;
    }
    /* Galerie und Profilboxen */
    #gallery,
    .chartWrap {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      width: 100%;
    }
    .tier-profil {
      width: 100%;
      max-width: 960px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .tier-bild {
      flex: 0 0 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tier-bild img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .tier-text {
      flex: 1;
      padding: 0 10px;
      text-align: center;
      font-size: 0.9em;
      color: #2c2c2c;
    }
    .tier-text strong {
      font-size: 1.1em;
      color: #1a1a1a;
      display: block;
      margin-bottom: 4px;
    }
    .tier-text p,
    .tier-text em {
      font-size: 0.85em;
    }
    .tier-diagramm {
      flex: 0 0 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Frage-Boxen und Antworten */
    .frage-box {
      background: #fff;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .frage-box h2 {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #2c3e50;
      font-weight: 600;
    }
    .skala-antwort {
      margin-bottom: 10px;
    }
    .skala-antwort label {
      color: #555555;
      font-weight: 500;
    }
    /* Dark Mode für Fragen */
    @media (prefers-color-scheme: dark) {
      .frage-box {
        background: #1e1e1e;
        color: #f0f0f0;
      }
      .frage-box h2 {
        color: #f0f0f0;
      }
      .skala-antwort label {
        color: #dddddd;
      }
      .skala-antwort input[type="radio"] {
        accent-color: #E44A00;
      }
    }
    /* Radio-Buttons orange einfärben */
    input[type="radio"] {
      accent-color: #E44A00;
    }
    /* Buttons */
    button {
      display: block;
      margin: 25px auto;
      padding: 12px 25px;
      font-size: 1rem;
      background-color: #E44A00;
      color: #fff;
      border: none;
      border-radius: 30px;
      cursor: pointer;
    }
    #ergebnis {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      margin: 30px auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: none;
    }
    /* Responsive Styles */
    @media screen and (max-width: 600px) {
      .frage-box, #ergebnis {
        padding: 15px;
      }
      canvas {
        max-width: 100% !important;
        height: auto !important;
      }
    }
    /* Druck-Stile */
    @media print {
      /* Elemente der Hauptseite ausblenden */
      #fragebogen, 
      button[type="submit"], 
      .logo-wrapper { 
        display: none;
      }
      /* Ergebnisbereich anzeigen */
      #ergebnis {
        display: block;
        width: 100%;
        padding: 10px;
      }
      #eule-logo {
        width: 50px !important;
        height: auto !important;
        margin-bottom: 10px !important;
      }
      .organisationszoo {
        font-size: 20px !important;
      }
      .category-header h2 {
        font-size: 1.2em !important;
      }
      .category-header p {
        font-size: 0.8em !important;
      }
      .page-break {
        page-break-after: always;
      }
      .second-evaluation {
        font-size: 10pt;
        margin: 0 auto;
        max-width: 100%;
        padding: 5mm;
      }
      .second-evaluation h2 {
        font-size: 14pt !important;
      }
      .second-evaluation h3 {
        font-size: 12pt !important;
      }
      .second-evaluation p {
        font-size: 10pt !important;
      }
      .second-evaluation canvas {
        max-width: 90% !important;
        height: auto !important;
      }
      /* Top-5-Bereich und Konfliktbereich dynamisch skalieren */
      .chartWrap {
        transform: scale(0.9);
        transform-origin: center top;
      }
      /* Reduziere die Abstände in den Profil-Boxen */
      .tier-profil {
        padding: 5px !important;
        margin-bottom: 10px !important;
      }
      /* Schriftgrössen in den Profil-Texten verkleinern */
      .tier-text strong {
        font-size: 1em !important;
      }
      .tier-text p, 
      .tier-text em {
        font-size: 0.8em !important;
      }
    }
/* Für den normalen Top‑5 Bereich: Stelle sicher, dass das Symbol nicht kursiv ist */
.tier-text span {
  font-style: normal;
}
/* Standard: Footer im Browser verstecken */
.print-footer {
  display: none;
}

/* Im Druck: Footer zeigen */
@media print {
  .print-footer {
    display: block;
    text-align: center;
    font-size: 0.75em;
    margin-top: 1cm;
  }
}

.tier-konflikt-container {
  display: flex;
  justify-content: space-between;
  gap: 40px;
  width: 90%;
  margin: 0 auto;
}

.tier-container {
  flex: 1;
  display: flex;
  align-items: center;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 12px;
  background-color: #f7f7f7;
  gap: 20px;
}

.tier-bild img {
  width: 100px;
  height: auto;
  border-radius: 8px;
}

.tier-text {
  flex: 1;
  text-align: left;
}

.tier-text strong {
  font-size: 1.2em;
  display: block;
  margin-bottom: 5px;
}
    @media (prefers-color-scheme: dark) {
      h1 {
        color: #ffffff;
        background-color: transparent;
      }
    }
    /* Finaler Dark Mode für gesamte Seite */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #111;
        color: #eee;
      }
      .beschreibung, .frage-box, #ergebnis {
        background-color: #222;
        color: #ddd;
      }
    }
    @media screen and (max-width: 600px) {
      #result-header {
        /* Skaliere den gesamten Container, damit er auf mobilen Geräten reinpasst */
        transform: scale(0.8);
        transform-origin: top left;
        /* Eventuell musst du die Breite erhöhen, damit die Skalierung korrekt funktioniert. Hier als Beispiel: */
        width: 125%;
      }
    }
    .tier-container {
      background: white;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      font-size: 0.85em;
      flex-wrap: wrap;
      color: #000; /* Textfarbe schwarz */
    }
    /* Dark Mode – Hintergrund & Textfarbe trotzdem wie im Light Mode */
    @media (prefers-color-scheme: dark) {
      .tier-container {
        background-color: white !important;
        color: #000 !important;
      }
    }
    /* Mobile Optimierung */
    @media screen and (max-width: 600px) {
      .tier-container {
        flex-direction: column;
        text-align: center;
        padding: 15px;
      }
      .tier-container > div {
        margin-bottom: 10px;
      }
      .tier-container img {
        height: auto;
        max-height: 120px;
      }
    }
    /* Standard-Styling für Textarea und Label in .user-inputs */
    .user-inputs textarea {
      width: 100%;
      max-width: 600px;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      resize: vertical;
      background-color: #fff;
      color: #000;
      transition: all 0.3s ease;
    }
    .user-inputs label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #222;
    }
    .user-inputs label span {
      display: block;
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.25rem;
    }
    /* Dark Mode (respektiert das OS-Setting) */
    @media (prefers-color-scheme: dark) {
      .user-inputs textarea {
        background-color: #1e1e1e;
        color: #f0f0f0;
        border: 1px solid #555;
      }
      .user-inputs label {
        color: #eee;
      }
      .user-inputs label span {
        color: #aaa;
      }
    }

:root {
  /* Helles Theme */
  --bg-color: #ffffff;
  --text-primary: #222222;
  --text-secondary: #444444;
  --border-color: #E44A00;
}

@media (prefers-color-scheme: dark) {
  .heading-wrapper h2,
  .heading-wrapper p {
    /* zwingend hell anzeigen */
    color: #ffffff !important;
  }
}

.heading-wrapper {
  max-width: 90%;
  width: 800px;
  margin: 50px auto 30px;
  padding: 0 16px;             /* sorgt für Abstand auf kleinen Bildschirmen */
  text-align: center;
}

.heading-wrapper h2 {
  font-size: 1.8em;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.heading-wrapper p {
  font-size: 0.95em;
  /* statt var(--text-secondary) jetzt: */
  color: var(--text-primary);
  line-height: 1.6;
}

.section {
  display: flex;
  flex-direction: column;      /* mobile: untereinander */
  align-items: center;
  gap: 16px;
  background-color: var(--bg-color);
  border-radius: 16px;
  padding: 20px;
  margin: 30px auto;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
  max-width: 90%;
  border-left: 6px solid var(--border-color);
}

/* Ab Tablet‑Grösse nebeneinander anordnen */
@media (min-width: 600px) {
  .section {
    flex-direction: row;
    gap: 24px;
    padding: 20px 28px;
  }
}

.section img {
  width: 90px;
  height: 90px;
  object-fit: contain;
  border-radius: 12px;
  background: #f0f0f0;
  padding: 8px;
}

.section .text {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section .text h3 {
  margin: 0;
  font-size: 1.1em;
  color: var(--text-primary);
}

.section .text p {
  margin: 0;
  font-size: 0.95em;
  color: var(--text-secondary);
  line-height: 1.4;
}
.reflexion-text {
  font-size: 0.95em;
  color: var(--text-secondary);
  line-height: 1.6;
}

@media (prefers-color-scheme: dark) {
  .reflexion-text {
    color: #ffffff !important;
  }
}
:root {
  --bg-card: #ffffff;
  --text-color: #000000;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg-card: #1e1e1e;
    --text-color: #ffffff;
  }
}
:root {
  --bg-color: #ffffff;
  --text-primary: #222222;
  --text-secondary: #666666;
  --border-color: #ccc;
  --accent-color: #E44A00;
}
/* In dein bestehendes <style>-Block */
.required-label::after {
  content: ' *';
  color: red;            /* oder var(--accent-color) */
  margin-left: 0.25rem;
  font-weight: bold;
}

/* Container für alle Felder */
.user-inputs {
  max-width: 480px;
  margin: 0 0 1.5rem 0;       /* oben 0, rechts 0, unten 1.5rem, links 0 */
  padding: 0;                 /* kein Innenabstand mehr */
  font-family: 'Open Sans', sans-serif;
  text-align: left;
}

/* Label-Style */
.user-inputs label {
  display: block;
  margin-bottom: 0.5rem;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
}

/* Hilfetexte unter Labels */
.user-inputs .help-text {
  margin: -0.25rem 0 0.75rem;
  font-size: 0.85rem;
  color: var(--text-secondary);
}

/* Inputs und Textareas */
.user-inputs input,
.user-inputs textarea {
  width: 100%;
  font-family: inherit;
  font-size: 1rem;
  color: var(--text-primary);
  background-color: var(--bg-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 0.75rem 1rem;
  box-sizing: border-box;
  transition: border-color 0.2s;
}

/* Mehrzeilige Felder */
.user-inputs textarea {
  resize: vertical;
}

/* Fokus-Zustand */
.user-inputs input:focus,
.user-inputs textarea:focus {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px rgba(228, 74, 0, 0.2);
}

/* Pflichtfeld-Stern im Feld */
.required-field {
  position: relative;
}
.required-field input {
  padding-right: 2rem;
}
.required-field::after {
  content: '*';
  position: absolute;
  top: 50%;
  right: 1rem;
  transform: translateY(-50%);
  color: var(--accent-color);
  font-size: 1.2rem;
  pointer-events: none;
}

/* Radio-Group (Selbst/Fremd) */
.user-inputs .radio-group {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.75rem;
  margin: 0.5rem 0 0 0;
}
.user-inputs .radio-group label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
}
.user-inputs .radio-group input[type="radio"] {
  accent-color: var(--accent-color);
  transform: scale(1.1);
}

/* Dark Mode */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-color: #1e1e1e;
    --text-primary: #eee;
    --text-secondary: #aaa;
    --border-color: #444;
  }
}

/* Mobile-Feinheiten */
@media (max-width: 600px) {
  .user-inputs {
    padding: 0 0.5rem;
  }
}
  </style>
</head>
<body>
  <div class="logo-container">
    <div class="logo-wrapper">
      <img src="eule-organisationszoo.png" alt="Eule" class="eule" />
      <div class="organisationszoo">OrganisationsZoo</div>
    </div>
  </div>

 <!-- 🐾 Einleitung (zentriert) -->
<div style="text-align: center;">
  <h2>Welcome to the <span style="color:#E44A00;">OrganisationsZoo</span></h2>
</div>

<!-- 💬 Einleitungstext (linksbündig) in einem eigenen Container -->
<div class="intro-text" style="text-align: left;">
  <p>
   Imagine you’re active in various areas of life – perhaps with friends, in a sports club, among family, or on leisure projects. Depending on the context, your perspective, behavior, and interactions with others can shift.
  </p>
  <p>
    This questionnaire is designed to help you get to know yourself better: How do you behave in everyday situations? What are your personal strengths? Where is there room for growth? Why do some relationships flow effortlessly while others encounter friction?
  </p>
  <p>
    There’s also a separate form for a <strong>third-party assessment</strong>, which friends, family members, or colleagues can fill out. This lets you compare your self-image with how others perceive you: How do you see yourself, and how do they see you? Where do your views align, and where do they diverge?
  </p>
  <p>
    Before you begin, put yourself in typical scenarios – a night out, a group project, a hobby session, or a discussion. Think about how you react, make decisions, and which of your traits you bring to the table.
  </p>
  <p>
    For each statement, choose a number from 0 (“doesn’t apply at all”) to 4 (“fully applies”). Answer honestly and intuitively – the more authentic you are, the more insightful your results will be.
  </p>
  <p>
    Have fun – and discover your animal-powered strengths! 
  </p>
</div>

<div class="user-inputs">
  <label>Who are you evaluating?</label>
  <div class="radio-group">
    <label><input type="radio" name="modus" value="self" checked> Myself</label>
    <label><input type="radio" name="modus" value="other"> Another person</label>
  </div>
</div>

  <!-- 🧍‍♀️ Eingabefelder für Name und E-Mail -->
<div class="user-inputs" style="max-width: 480px; margin-bottom: 2rem;">
  
  <label for="name" style="font-weight: 700; display: block; margin-bottom: 0.5rem; color: var(--text-primary);">
  Name:
  </label>
  <input 
    type="text" 
    id="name" 
    name="name" 
    placeholder="your name"
    style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 1.5rem;"
  />

<div class="user-inputs">
  <!-- 1. Label mit rotem Stern -->
  <label for="email" class="required-label">E-Mail-Adresse</label>

<!-- 3. Hilfetext darunter -->
  <p class="help-text">
    Please enter your email address – it is necessary to display your result.
  </p>
  
  <!-- 2. Input-Feld -->
  <input
    type="email"
    id="email"
    name="email"
    placeholder="your@email.ch"
    required
  />
</div>
</div>

<div class="user-inputs">
  <label for="situation">Which situation are you imagining?</label>
  <p class="help-text">
    e.g., "Me in a group of friends," "Me in a sports club with teammates," or "Me at a family gathering"
  </p>
  <textarea
    id="situation"
    name="situation"
    rows="3"
    placeholder="Briefly describe your role and situation"
    required
  ></textarea>
</div>

<h1>Dein Fragebogen</h1>

  <!-- 📋 Der Fragebogen -->
  <form id="fragebogen"></form>

  <!-- 🔘 Auswerten-Button (anfangs deaktiviert) -->
  <button type="submit" form="fragebogen" id="auswertenBtn" disabled>Evaluate</button>

  <!-- 🖨 Ergebnis + Druckbutton -->
  <div id="ergebnis" style="display:none;"></div>
  <button id="printButton" style="display:none;"> Print</button>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const formElem     = document.getElementById("fragebogen");
  const ergebnisElem = document.getElementById("ergebnis");
  const printButton  = document.getElementById("printButton");
let attributeData = {};
function makeFileName(name) {
  return name
    .toLowerCase()
    .replaceAll("ä", "ae")
    .replaceAll("ö", "oe")
    .replaceAll("ü", "ue")
    .replaceAll("ss", "ss")
    .replaceAll(" ", "_")
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");
}
      
      // Array der Fragen
       const questions = [
  {
    frage: "Question 1: If you're planning a weekend trip with friends, which role do you prefer to take on?",
    frage_fremd: "Question 1: What role does the person take when planning a weekend trip with friends?",
    keyword: "Trip",
    answers: {
      A: {
        code: "S1",
        text: "I like to organize <strong>everything in detail</strong>, book accommodations, and create a schedule.",
        text_fremd: "The person likes to organize <strong>everything in detail</strong>, book and plan carefully."
      },
      B: {
        code: "S2",
        text: "I make sure that <strong>everyone is heard</strong> and exchange ideas within the team.",
        text_fremd: "The person ensures that <strong>everyone is heard</strong> and ideas are shared."
      },
      C: {
        code: "R1",
        text: "I stay <strong>flexible</strong> and adapt the plan spontaneously when needed.",
        text_fremd: "The person stays <strong>flexible</strong> and adapts plans spontaneously."
      },
      D: {
        code: "R2",
        text: "I bring in <strong>creative</strong> ideas, such as unusual places or activities.",
        text_fremd: "The person likes to suggest <strong>creative</strong> ideas for special experiences."
   }
    }
  },
  {
     frage: "Question 2: Your friend gets into a conflict with someone from your group – how do you react?",
  frage_fremd: "Question 2: How does the person react when a conflict arises among friends?",
  keyword: "Conflict",
  answers: {
    A: {
      code: "S3",
      text: "I mediate directly and listen to both sides <strong>carefully</strong> to find a solution.",
      text_fremd: "The person mediates directly, listens to both sides <strong>carefully</strong>, and seeks consensus."
    },
    B: {
      code: "S4",
      text: "I stay <strong>neutral</strong> and ask what each person needs before intervening.",
      text_fremd: "The person remains <strong>neutral</strong> and explores needs before helping."
    },
    C: {
      code: "R3",
      text: "I ask provocative questions to break up <strong>perspectives</strong> – even if it may cause friction.",
      text_fremd: "The person asks provocative questions to break up stuck <strong>perspectives</strong>."
    },
    D: {
      code: "R4",
      text: "I stay calm, speak <strong>thoughtfully</strong>, and try to soothe the atmosphere.",
      text_fremd: "The person stays calm, speaks <strong>thoughtfully</strong>, and soothes the mood."
    }
    }
  },
  {
  frage: "Question 3: What motivates you to really stick with a new hobby or project?",
  frage_fremd: "Question 3: What motivates the person to start and stick with a new hobby or project?",
  keyword: "Motivation",
  answers: {
    A: {
      code: "S5",
      text: "The joy of <strong>learning</strong> and curiosity for new things drives me.",
      text_fremd: "The person is motivated by the joy of <strong>learning</strong> and curiosity."
    },
    B: {
      code: "S6",
      text: "I look for a <strong>vision</strong> or goal that inspires and drives me.",
      text_fremd: "The person needs a clear <strong>vision</strong> or inspiring goal."
    },
    C: {
      code: "R5",
      text: "I am excited to tackle challenges <strong>strategically</strong> and solve them cleverly.",
      text_fremd: "The person loves to approach challenges <strong>strategically</strong>."
    },
    D: {
      code: "R6",
      text: "I want to see fast <strong>results</strong> and invest a lot of energy to move forward.",
      text_fremd: "The person invests a lot of energy to quickly achieve <strong>results</strong>."
   }
    }
  },
  {
  frage: "Question 4: A sudden change of plans throws you off – how do you react?",
  frage_fremd: "Question 4: How does the person react when plans change at short notice?",
  keyword: "Change",
  answers: {
    A: {
      code: "S7",
      text: "I take a moment, stay calm, and <strong>analyze</strong> the new situation.",
      text_fremd: "The person calmly analyzes the new situation and stays composed."
    },
    B: {
      code: "S8",
      text: "I look at risks and opportunities, replan, and find <strong>alternatives</strong>.",
      text_fremd: "The person examines risks, opportunities, and plans <strong>alternatives</strong>."
    },
    C: {
      code: "R7",
      text: "I react spontaneously and <strong>act</strong> before overthinking.",
      text_fremd: "The person acts spontaneously and avoids overthinking."
    },
    D: {
      code: "R8",
      text: "I trust my gut feeling and make quick <strong>decisions</strong>.",
      text_fremd: "The person trusts their instincts and makes quick <strong>decisions</strong>."
     }
    }
  },
  {
   frage: "Question 5: In what kind of environment do you feel most creative?",
    frage_fremd: "Question 5: In what environment does the person feel most creative?",
    keyword: "Environment",
    answers: {
      A: { code: "S9", text: "A quiet place where I can <strong>think</strong> undisturbed.", text_fremd: "The person needs a quiet place to <strong>think</strong> undisturbed." },
      B: { code: "S10", text: "An inspiring environment with <strong>others</strong> that fosters exchange.", text_fremd: "The person thrives in an inspiring atmosphere with <strong>others</strong>." },
      C: { code: "R11", text: "Something <strong>provocative</strong> that breaks conventional thinking.", text_fremd: "The person reacts well to <strong>provocative</strong> stimuli." },
      D: { code: "R12", text: "A clear structure with firm rules that provides <strong>reliability</strong>.", text_fremd: "The person values clear rules and <strong>reliability</strong>." 
     }
    }
  },
  {
    frage: "Question 6: You're facing an uncertain decision – how do you find your way?",
    frage_fremd: "Question 6: How does the person make decisions in unclear situations?",
    keyword: "Decision",
    answers: {
      A: { code: "S11", text: "I discuss with friends and seek <strong>consensus</strong>.", text_fremd: "The person involves friends and seeks <strong>consensus</strong>." },
      B: { code: "S12", text: "I stick to proven methods and value <strong>consistency</strong>.", text_fremd: "The person relies on proven methods and <strong>consistency</strong>." },
      C: { code: "R9", text: "I act quickly and <strong>decisively</strong> without hesitation.", text_fremd: "The person acts quickly and <strong>decisively</strong>." },
      D: { code: "R10", text: "I trust my instincts and follow my <strong>intuition</strong>.", text_fremd: "The person trusts their instincts and <strong>intuition</strong>." 
     }
    }
  },
  {
    frage: "Question 7: When you go out to eat with friends, what role do you take at the table?",
    frage_fremd: "Question 7: What role does the person take when dining with friends?",
    keyword: "Dining",
    answers: {
      A: { code: "S13", text: "I like trying new things and suggesting <strong>varied</strong> dishes.", text_fremd: "The person enjoys suggesting <strong>varied</strong> dishes." },
      B: { code: "S14", text: "I focus on efficient organization and handle <strong>reservations</strong>.", text_fremd: "The person organizes reservations and plans efficiently." },
      C: { code: "R15", text: "I maintain good mood and support <strong>team spirit</strong> at the table.", text_fremd: "The person fosters good mood and <strong>team spirit</strong>." },
      D: { code: "R16", text: "I take over <strong>communication</strong> with the service.", text_fremd: "The person handles <strong>communication</strong> with the service." 
     }
    }
  },
  {
    frage: "Question 8: You’re responsible for a shared project at home – how do you handle responsibility?",
    frage_fremd: "Question 8: How does the person handle responsibility in a shared project?",
    keyword: "Responsibility",
    answers: {
      A: { code: "S15", text: "I support in the background and ensure <strong>structure</strong>.", text_fremd: "The person supports in the background and ensures <strong>structure</strong>." },
      B: { code: "S16", text: "I make clear decisions and implement my <strong>ideas</strong>.", text_fremd: "The person makes decisions and implements <strong>ideas</strong>." },
      C: { code: "R13", text: "I plan strategically and act <strong>goal-oriented</strong>.", text_fremd: "The person plans strategically and acts <strong>goal-oriented</strong>." },
      D: { code: "R14", text: "I take everything into my own hands and rely on my <strong>competence</strong>.", text_fremd: "The person handles everything and trusts their <strong>competence</strong>." 
     }
    }
  },
  {
    frage: "Question 9: How do you react when someone from your friend circle criticizes you?",
    frage_fremd: "Question 9: How does the person react to criticism from friends?",
    keyword: "Criticism",
    answers: {
      A: { code: "S17", text: "I listen openly and think about how to <strong>improve</strong>.", text_fremd: "The person listens openly and considers how to <strong>improve</strong>." },
      B: { code: "S18", text: "I calmly explain my point and stay <strong>confident</strong>.", text_fremd: "The person explains calmly and remains <strong>confident</strong>." },
      C: { code: "R19", text: "I deeply reflect and learn from <strong>constructive</strong> criticism.", text_fremd: "The person deeply reflects and learns from <strong>constructive</strong> criticism." },
      D: { code: "R20", text: "I accept feedback and use it as an opportunity for <strong>growth</strong>.", text_fremd: "The person uses feedback as a chance for <strong>growth</strong>." 
     }
    }
  },
  {
    frage: "Question 10: What role do you take when traveling with friends?",
    frage_fremd: "Question 10: What role does the person take when traveling?",
    keyword: "Travel",
    answers: {
      A: { code: "S19", text: "I take the <strong>lead</strong> and plan the route and daily activities.", text_fremd: "The person takes the <strong>lead</strong> and plans the program." },
      B: { code: "S20", text: "I handle details and ensure everyone's <strong>comfort</strong>.", text_fremd: "The person handles details and ensures <strong>comfort</strong>." },
      C: { code: "R21", text: "I bring <strong>visions</strong> and dream of unforgettable moments.", text_fremd: "The person brings <strong>visions</strong> for highlights." },
      D: { code: "R22", text: "I stick to classic destinations and focus on <strong>safety</strong>.", text_fremd: "The person prefers classics and <strong>safety</strong>." 
     }
    }
  },
  {
    frage: "Question 11: How do you plan your long-term goals, such as a world trip or major project?",
    frage_fremd: "Question 11: How does the person approach planning long-term goals?",
    keyword: "Planning",
    answers: {
      A: { code: "S21", text: "I set ambitious <strong>milestones</strong> and work towards them.", text_fremd: "The person sets <strong>milestones</strong> and works towards them." },
      B: { code: "S22", text: "I stay <strong>flexible</strong> and adjust goals to new circumstances.", text_fremd: "The person stays <strong>flexible</strong> and adapts goals." },
      C: { code: "R17", text: "I maintain an <strong>overview</strong> and formulate clear visions.", text_fremd: "The person keeps an <strong>overview</strong> and formulates visions." },
      D: { code: "R18", text: "I proceed cautiously and don't let stress <strong>overwhelm</strong> me.", text_fremd: "The person proceeds cautiously and stays stress-resistant." 
     }
    }
  },
  {
    frage: "Question 12: How do you react under high pressure (e.g., deadline, exam)?",
    frage_fremd: "Question 12: How does the person react under high pressure?",
    keyword: "Pressure",
    answers: {
      A: { code: "S23", text: "I stay calm, structure my tasks, and keep my <strong>focus</strong>.", text_fremd: "The person stays calm, structured, and focused." },
      B: { code: "S24", text: "I withdraw and work <strong>concentrated</strong> alone.", text_fremd: "The person withdraws and works <strong>concentrated</strong>." },
      C: { code: "R25", text: "I work systematically, prioritize, and avoid <strong>mistakes</strong>.", text_fremd: "The person works systematically, prioritizes, and avoids mistakes." },
      D: { code: "R26", text: "I speed up and deliver top performance under <strong>maximum pressure</strong>.", text_fremd: "The person speeds up and performs under <strong>maximum pressure</strong>." 
     }
    }
  },
  {
    frage: "Question 13: What is your most reliable strength in everyday life?",
    frage_fremd: "Question 13: What strength does the person reliably show in everyday life?",
    keyword: "Strength",
    answers: {
      A: { code: "S25", text: "My <strong>creativity</strong> helps me find new solutions.", text_fremd: "The person shows <strong>creativity</strong> in new situations." },
      B: { code: "S26", text: "My <strong>endurance</strong> helps me overcome challenges.", text_fremd: "The person shows great <strong>endurance</strong> and perseverance." },
      C: { code: "R23", text: "My <strong>adaptability</strong> keeps me capable in any situation.", text_fremd: "The person adapts quickly and stays capable." },
      D: { code: "R24", text: "My <strong>cooperation skills</strong> strengthen any community.", text_fremd: "The person fosters community through <strong>cooperation</strong>." 
     }
    }
  },
  {
    frage: "Question 14: Which combination of traits best describes you?",
    frage_fremd: "Question 14: Which combination of traits fits the person?",
    keyword: "Mix",
    answers: {
      A: { code: "C1", text: "Visionary, adaptable, creative, and energetic.", text_fremd: "Visionary, adaptable, creative, and energetic fits." },
      B: { code: "C2", text: "Robust, independent, decisive, and focused.", text_fremd: "Robust, independent, decisive, and focused fits." },
      C: { code: "C3", text: "Thoughtful, wise, strategic, and careful.", text_fremd: "Thoughtful, wise, strategic, and careful fits." },
      D: { code: "C4", text: "Spontaneous, provocative, social, and curious.", text_fremd: "Spontaneous, provocative, social, and curious fits." 
    }
    }
  },
  {
    frage: "Question 15: In which area would you like to grow personally?",
    frage_fremd: "Question 15: In which area could the person develop?",
    keyword: "Growth",
    answers: {
      A: { code: "C1", text: "Become more relaxed and want to <strong>control</strong> less.", text_fremd: "The person could learn to <strong>control</strong> less." },
      B: { code: "C2", text: "Be more patient in handling my <strong>impulses</strong>.", text_fremd: "The person could be more patient with <strong>impulses</strong>." },
      C: { code: "C3", text: "Make braver decisions and avoid <strong>hesitation</strong>.", text_fremd: "The person could be braver and hesitate less." },
      D: { code: "C4", text: "Better <strong>channel</strong> my spontaneity.", text_fremd: "The person could better <strong>channel</strong> their spontaneity." 
     }
    }
  }
];



  // 1) renderQuestions-Funktion
  function renderQuestions() {
    formElem.innerHTML = ""; // altes löschen

    const modus = document.querySelector('input[name="modus"]:checked').value;
    questions.forEach((q, index) => {
      const box = document.createElement("div");
      box.className = "frage-box";

      // Frage je nach Modus
      let frageText = modus === "fremd" ? q.frage_fremd : q.frage;
      if (q.keyword) {
        frageText = frageText.replace(
          new RegExp(`(${q.keyword})`, 'gi'),
          '<strong>$1</strong>'
        );
      }
      box.innerHTML = `<h2><strong>${frageText}</strong></h2>`;

      // Antworten
      Object.entries(q.answers).forEach(([key, ans]) => {
        const div = document.createElement("div");
        div.className = "skala-antwort";

        let radios = "";
        for (let i = 0; i <= 4; i++) {
          radios += `<label>
                       <input type="radio"
                              name="frage${index}_${ans.code}"
                              value="${i}"
                              required /> ${i}
                     </label>`;
        }

        const ansText = modus === "fremd" ? ans.text_fremd : ans.text;
        div.innerHTML = `<p><strong>${key}:</strong> ${ansText}</p>${radios}`;
        box.appendChild(div);
      });

      formElem.appendChild(box);
    });
  }

  // 3) Initiales Rendering + Umschalten per Radio
   renderQuestions();
  document.querySelectorAll('input[name="modus"]')
          .forEach(r => r.addEventListener('change', renderQuestions));


      // Definiere hier zuerst das Mapping der Tierdaten:
      const animalProperties = {
        "Ant": {
  strengths: [
    "industrious", "loyal", "committed", "territorial",
    "instinctive", "busy", "hard-working", "focused on the moment"
  ],
  weaknesses: [
    "sensitive", "thoughtful", "logical", "decisive",
    "individualistic", "self-confident", "visionary", "reflective"
  ]
},
"Bee": {
  strengths: [
    "industrious", "team-oriented", "communicative", "territorial",
    "knowledgeable", "hard-working", "cooperative", "social", "organized",
    "intelligent", "loyal", "caring", "aggressive"
  ],
  weaknesses: [
    "self-aware", "individualistic", "gullible",
    "political", "reflective", "slow"
  ]
},
"Chameleon": {
  strengths: [
    "duplicitous", "clever", "manipulative", "weak",
    "political", "intelligent"
  ],
  weaknesses: [
    "loyal", "trustworthy", "consistent", "confident",
    "challenging", "action-oriented"
  ]
},
"Dog": {
  strengths: [
    "loyal", "trustful", "enthusiastic", "impulsive",
    "gullible", "energetic", "reliable", "predictable",
    "happy", "playful", "productive", "trustworthy"
  ],
  weaknesses: [
    "careful", "serious", "thoughtful", "thinking", "clever"
  ]
},
"Eagle": {
  strengths: [
    "visionary", "strong", "focused", "inspiring", "confident",
    "intelligent", "productive", "decisive", "balanced",
    "sharp", "action-oriented", "open", "trustworthy", "intuitive",
    "aggressive", "responsible", "holistic", "extroverted", "respected"
  ],
  weaknesses: [
    "hesitant", "emotional", "weak", "withdrawn", "shy", "slow"
  ]
},
"Cat": {
  strengths: [
    "individualistic", "eager", "distant", "vain",
    "selfish", "frustrating", "arrogant", "conceited"
  ],
  weaknesses: [
    "sociable", "friendly", "caring", "team-oriented",
    "community-oriented", "interesting"
  ]
},
"Gibbon": {
  strengths: [
    "cheerful", "playful", "lively", "sociable", "cool",
    "enthusiastic", "funny", "interesting", "rebellious"
  ],
  weaknesses: [
    "cautious", "serious", "productive", "future-oriented", "focused"
  ]
},
"Hyena": {
  strengths: [
    "aggressive", "scheming", "controlling", "manipulative",
    "team-oriented", "strong", "political", "opportunistic"
  ],
  weaknesses: [
    "trustworthy", "caring", "considerate", "intuitive", "shy"
  ]
},
"Useful_Insect": {
  strengths: [
    "supportive", "inventive", "future-oriented", "team-oriented",
    "helpful", "productive", "positive", "forward-looking"
  ],
  weaknesses: [
    "hesitant", "slow", "over-adapted", "barely visible", "emotionless"
  ]
},
"Annoying_Insect": {
  strengths: [
    "omnipresent", "self-serving", "unpredictable", "assertive",
    "persistent", "resistant"
  ],
  weaknesses: [
    "selfish", "useful", "caring", "productive", "modest", "trustworthy"
  ]
},
"Jackal": {
  strengths: [
    "territorial", "defensive", "social", "aggressive",
    "controlling", "lively", "jealous", "joyful", "loyal", "caring"
  ],
  weaknesses: [
    "patient", "tolerant", "shy", "withdrawn", "caring"
  ]
},
"Child": {
  strengths: [
    "naive", "playful", "energetic", "motivated", "sacrificial", "enthusiastic", "youthful"
  ],
  weaknesses: [
    "experienced", "reliable", "knowledgeable", "tough", "clever"
  ]
},
"Lion": {
  strengths: [
    "strong", "power-oriented", "aggressive", "controlling",
    "territorial", "lazy", "self-serving", "manipulative", "confident"
  ],
  weaknesses: [
    "committed", "industrious", "caring", "shy", "emotional"
  ]
},
"Mouse": {
  strengths: [
    "eager", "productive", "economical", "reliable", "enthusiastic",
    "invisible", "busy", "individualistic", "intelligent"
  ],
  weaknesses: [
    "lazy", "extroverted", "self-serving", "aggressive", "emotional"
  ]
},
"Parasite": {
  strengths: [
    "lazy", "parasitic", "dependent", "self-serving", "invisible"
  ],
  weaknesses: [
    "community-oriented", "productive", "friendly", "considerate", "useful"
  ]
},
"Owl": {
  strengths: [
    "wise", "committed", "helpful", "respected", "knowledgeable",
    "logical", "sharp", "confident", "calm", "community-oriented"
  ],
  weaknesses: [
    "lazy", "extroverted", "egocentric", "ambitious", "aggressive"
  ]
},
"Piranha": {
  strengths: [
    "aggressive", "predatory", "dangerous", "selfish", "frustrating",
    "swarming", "self-serving"
  ],
  weaknesses: [
    "friendly", "trustworthy", "accessible", "happy", "trustful",
    "sincere", "individualistic", "forward-looking"
  ]
},
"Oak": {
  strengths: [
    "knowledgeable", "decisive", "intelligent", "experienced",
    "stimulating", "inspiring", "enthusiastic", "parent-like", "reliable",
    "philanthropic", "accessible", "rare"
  ],
  weaknesses: [
    "selfish", "disinterested", "lazy", "emotional", "aggressive"
  ]
},
"Rattlesnake": {
  strengths: [
    "political", "cunning", "defensive", "reactive", "insecure", "loud",
    "duplicitous", "divisive", "survivor", "adapted to harsh environments"
  ],
  weaknesses: [
    "trustworthy", "sincere", "loyal", "trustful", "happy",
    "sociable", "inviting"
  ]
},
"Sloth": {
  strengths: [
    "slow", "tired", "minimalistic", "submissive", "lazy"
  ],
  weaknesses: [
    "sociable", "eager", "enthusiastic", "productive", "busy",
    "adaptable", "community-oriented", "useful"
  ]
},
"Dinosaur": {
  strengths: [
    "tired", "pessimistic", "change-averse", "xenophobic", "withdrawn",
    "battle-tested", "tough", "negative", "reflective", "nostalgic", "problematic"
  ],
  weaknesses: [
    "visionary", "adaptable", "cooperative", "open", "adjusted", "sharp-minded",
    "community-oriented", "opportunistic", "youthful", "social"
  ]
},
"Unicorn": {
  strengths: [
    "perfect", "honest", "arrogant", "unapproachable", "ambitious",
    "frustrating", "insecure", "controlling", "dangerous", "inconsistent", "nostalgic"
  ],
  weaknesses: [
    "realistic", "self-confident", "open", "stimulating", "trustworthy",
    "modest", "honest", "forward-looking", "motivating"
  ]
},
"Vulture": {
  strengths: [
    "mean", "adapted", "scavenging", "egocentric", "dangerous", "opportunistic",
    "political", "competitive", "clever", "patient"
  ],
  weaknesses: [
    "benevolent", "trustworthy", "happy", "team-oriented", "brave",
    "open", "pleasant", "social"
  ]
},
"Whale": {
  strengths: [
    "intelligent", "inspiring", "knowledgeable", "powerful", "social",
    "community-oriented", "self-limiting", "accident-prone", "reserved",
    "gentle", "endangered"
  ],
  weaknesses: [
    "adaptable", "aggressive", "lazy", "arrogant", "dangerous", "manipulative"
  ]
},
"Hybrid": {
  strengths: [
    "arrogant", "ambitious", "busy", "extroverted", "educated", "verbose",
    "selfish", "beautiful", "fashionable", "competent"
  ],
  weaknesses: [
    "experienced", "trustworthy", "tolerant", "patient", "caring", "thorough", "adaptable"
  ]
},
"Yak": {
  strengths: [
    "stormy", "enthusiastic", "tactical", "friendly", "frustrating", "cheerful",
    "playful", "energetic", "social", "happy", "focused"
  ],
  weaknesses: [
    "cautious", "patient", "experienced", "considerate", "reserved", "modest",
    "gentle", "slow", "strategic", "self-confident", "intelligent"
          ]
        }
      };

      // Initialisiere das Mapping-Objekt
      const similarityMapping = {};
      Object.keys(animalProperties).forEach(animal => {
        similarityMapping[animal] = [];
      });
      // Vergleiche jedes Tier mit allen anderen
      Object.keys(animalProperties).forEach(animal => {
        Object.keys(animalProperties).forEach(otherAnimal => {
          if (animal === otherAnimal) return; // Selbstvergleich überspringen
          const strengthsAnimal = animalProperties[animal].strengths;
          const strengthsOther = animalProperties[otherAnimal].strengths;
          const commonStrengths = strengthsAnimal.filter(strength => strengthsOther.includes(strength));
          if (commonStrengths.length > 0) {
            similarityMapping[animal].push({
              animal: otherAnimal,
              commonStrengths: commonStrengths,
              similarityScore: commonStrengths.length
            });
          }
        });
      });
      console.log(similarityMapping);

      // Definition der tierEigenschaften
      const tierEigenschaften = {
  "Ant": ["Structure", "Social Behavior"],
  "Bee": ["Structure", "Social Behavior"],
  "Chameleon": ["Flexibility", "Strategy"],
  "Dog": ["Empathy", "Social Behavior"],
  "Eagle": ["Strategy", "Assertiveness"],
  "Cat": ["Strategy", "Flexibility"],
  "Gibbon": ["Creativity", "Social Behavior"],
  "Hyena": ["Assertiveness", "Strategy"],
  "Useful_Insect": ["Empathy", "Creativity"],
  "Annoying_Insect": ["Flexibility", "Assertiveness"],
  "Jackal": ["Assertiveness", "Social Behavior"],
  "Lion": ["Assertiveness", "Strategy"],
  "Mouse": ["Structure", "Emotional Stability"],
  "Parasite": ["Flexibility", "Strategy"],
  "Owl": ["Strategy", "Empathy"],
  "Piranha": ["Assertiveness", "Flexibility"],
  "Oak": ["Structure", "Emotional Stability"],
  "Rattlesnake": ["Strategy", "Flexibility"],
  "Sloth": ["Emotional Stability", "Structure"],
  "Dinosaur": ["Structure", "Emotional Stability"],
  "Unicorn": ["Creativity", "Empathy"],
  "Vulture": ["Strategy", "Flexibility"],
  "Whale": ["Empathy", "Emotional Stability"],
  "Hybrid": ["Creativity", "Assertiveness"],
  "Yak": ["Social Behavior", "Emotional Stability"],
  "Child": ["Creativity", "Empathy"]
      };

      // Mapping CODE -> Tier
      const codeToTier = {
S1: "Eagle",   S2: "Ant",     R1: "Yak",     R2: "Cat",
S3: "Bee",     S4: "Chameleon", R3: "Parasite", R4: "Whale",
S5: "Dinosaur", S6: "Unicorn", R5: "Jackal", R6: "Piranha",
S7: "Oak",     S8: "Owl",     R7: "Mouse",    R8: "Lion",
S9: "Sloth",   S10: "Vulture", R11: "Annoying_Insect", R12: "Useful_Insect",
S11: "Gibbon", S12: "Dog",    R9: "Rattlesnake", R10: "Child",
S13: "Hybrid", S14: "Hyena",   R15: "Dog",    R16: "Gibbon",
S15: "Useful_Insect", S16: "Annoying_Insect", R13: "Hyena", R14: "Hybrid",
S17: "Child",  S18: "Rattlesnake", R19: "Owl", R20: "Oak",
S19: "Lion",   S20: "Mouse",    R21: "Unicorn", R22: "Dinosaur",
S21: "Piranha", S22: "Jackal", R17: "Vulture",  R18: "Sloth",
S23: "Whale",  S24: "Parasite", R25: "Ant", R26: "Eagle",
S25: "Cat",    S26: "Yak",     R23: "Chameleon", R24: "Bee"
      };

      // Antwortkombinationen für Frage 14 und 15
      const comboMapping = {
 C1: ["Eagle", "Ant", "Bee", "Chameleon", "Whale", "Unicorn"],
C2: ["Yak", "Cat", "Parasite", "Dinosaur", "Jackal", "Piranha"],
C3: ["Oak", "Owl", "Mouse", "Lion", "Sloth", "Vulture", "Hybrid"],
C4: ["Annoying_Insect", "Useful_Insect", "Rattlesnake", "Child", "Hyena", "Dog", "Gibbon"]
      };

      // Tier-Beschreibungen
      const tierTexte = {
"Ant": { kurz: " Organized, team-oriented, methodical", symbolischFür: "Team Spirit" },
"Bee": { kurz: " Hardworking, responsible, adaptable", symbolischFür: "Cohesion" },
"Chameleon": { kurz: " Adaptable, visionary, sometimes manipulative", symbolischFür: "Adaptability" },
"Dog": { kurz: " Enthusiastic, emotional, open", symbolischFür: "Loyalty" },
"Eagle": { kurz: " Intuitive, strategic, competitive", symbolischFür: "Vision" },
"Cat": { kurz: " Thoughtful, independent, rebellious", symbolischFür: "Freedom" },
"Gibbon": { kurz: " Sociable, reflective, sometimes distant", symbolischFür: "Communication" },
"Hyena": { kurz: " Strategic, ambitious, aggressive", symbolischFür: "Determination" },
"Useful_Insect": { kurz: " Supportive, imaginative, positive", symbolischFür: "Usefulness" },
"Annoying_Insect": { kurz: " Self-willed, unpredictable, often disruptive", symbolischFür: "Persistence" },
"Jackal": { kurz: " Individualistic, aggressive, rebellious", symbolischFür: "Independence" },
"Lion": { kurz: " Intuitive, power-conscious, strategic", symbolischFür: "Strength" },
"Mouse": { kurz: " Thoughtful, cautious, reliable", symbolischFür: "Security" },
"Parasite": { kurz: " Invisible, manipulative, adaptable", symbolischFür: "Camouflage" },
"Owl": { kurz: " Wise, logical, reflective", symbolischFür: "Wisdom" },
"Piranha": { kurz: " Dangerous, action-oriented, manipulative", symbolischFür: "Aggression" },
"Oak": { kurz: " Strong, productive, inspiring", symbolischFür: "Stability" },
"Rattlesnake": { kurz: " Dangerous, intelligent, cunning", symbolischFür: "Cunning" },
"Sloth": { kurz: " Patient, modest, slow", symbolischFür: "Calmness" },
"Dinosaur": { kurz: " Strong, distant, withdrawn", symbolischFür: "Ancient Power" },
"Unicorn": { kurz: " Visionary, adaptable, naive", symbolischFür: "Dreaminess" },
"Vulture": { kurz: " Foresighted, intuitive, low loyalty", symbolischFür: "Opportunism" },
"Whale": { kurz: " Trustworthy, strong, emotional", symbolischFür: "Depth" },
"Hybrid": { kurz: " Intelligent, adaptable, distant", symbolischFür: "Universality" },
"Yak": { kurz: " Robust, modest, strategic", symbolischFür: "Endurance" },
"Child": { kurz: " Enthusiastic, inspiring, emotional", symbolischFür: "Carefreeness" }
      };

      // Gegenspieler-Logik
      const gegenspieler = {
"Eagle": "Child",
"Child": "Eagle",
"Ant": "Hybrid",
"Hybrid": "Ant",
"Bee": "Hyena",
"Hyena": "Bee",
"Chameleon": "Owl",
"Owl": "Chameleon",
"Dog": "Cat",
"Cat": "Dog",
"Gibbon": "Parasite",
"Parasite": "Gibbon",
"Lion": "Mouse",
"Mouse": "Lion",
"Whale": "Jackal",
"Jackal": "Whale",
"Useful_Insect": "Annoying_Insect",
"Annoying_Insect": "Useful_Insect",
"Piranha": "Sloth",
"Sloth": "Piranha",
"Unicorn": "Vulture",
"Vulture": "Unicorn",
"Oak": "Rattlesnake",
"Rattlesnake": "Oak",
"Yak": "Dinosaur",
"Dinosaur": "Yak"
      };

      // Konflikt-Texte zwischen den Tieren
      const tierKonflikte = {
        "Eagle": {
  "Child": "Tensions may arise between Eagle and Child, as the strategic Eagle follows a clear plan while the Child acts impulsively.",
  "Whale": "Eagle and Whale may have different work rhythms – Eagle strives for speed, Whale prefers calmness."
},
"Ant": {
  "Piranha": "Ant and Piranha show different approaches: Ant plans methodically, Piranha acts impulsively.",
  "Hybrid": "Ant and Hybrid may differ in their methods – clear procedures versus flexible, changing approaches."
},
"Bee": {
  "Hyena": "Bee and Hyena may experience tensions, as the team-oriented Bee seeks cooperation, while Hyena acts more independently.",
  "Dinosaur": "Bee and Dinosaur often stand in contrast: Bee works for the team, Dinosaur acts pragmatically."
},
"Chameleon": {
  "Owl": "Chameleon and Owl may collide in their approach – Chameleon often changes course, Owl seeks clear, logical lines.",
  "Oak": "Chameleon and Oak have different expectations: change versus stability."
},
"Dog": {
  "Cat": "Dog and Cat may have different needs – Dog seeks closeness, Cat prefers independence.",
  "Parasite": "Dog and Parasite differ in how openly they act – Dog is direct, Parasite is more tactically reserved."
},
"Cat": {
  "Dog": "Even though Dog and Cat are close, conflicts may arise when the need for closeness (Dog) meets the desire for distance (Cat).",
  "Gibbon": "Cat and Gibbon may experience tensions, as the quiet Cat may not always fit the communicative temperament of Gibbon."
},
"Gibbon": {
  "Yak": "Gibbon and Yak have different communication styles – Gibbon is very open, while Yak values stability and calmness.",
  "Parasite": "Gibbon and Parasite may disagree, as Gibbon prefers more direct conversations, while Parasite acts more subtly."
},
"Hyena": {
  "Unicorn": "Hyena and Unicorn differ significantly: Hyena is controlling and goal-oriented, while Unicorn acts idealistically and dreamily.",
  "Bee": "Hyena and Bee may experience tensions, as the goal-oriented Hyena acts independently, while Bee focuses on teamwork."
},
"Useful_Insect": {
  "Parasite": "Useful Insect and Parasite have different priorities – support versus tactical behavior.",
  "Rattlesnake": "Useful Insect and Rattlesnake proceed differently: cooperative approaches versus critical impulses."
},
"Annoying_Insect": {
  "Child": "Annoying Insect and Child may clash, as the unpredictable Insect can overwhelm the emotional Child.",
  "Dog": "Annoying Insect provokes, while Dog seeks harmony – leading to tensions."
},
"Jackal": {
  "Whale": "Jackal and Whale may have different focuses – tactical behavior versus emotional depth.",
  "Child": "Jackal and Child often have different priorities: structured action versus impulsive behavior."
},
"Lion": {
  "Mouse": "Lion and Mouse often face off: the dominant Lion acts energetically, while the cautious Mouse tends to retreat.",
  "Owl": "Lion and Owl may differ in pace – quick decisions versus analytical considerations."
},
"Mouse": {
  "Hyena": "Mouse and Hyena may create tensions, as the calm Mouse seeks stability, while Hyena acts forcefully and assertively.",
  "Lion": "Mouse and Lion show different dynamics: caution versus dominant presence."
},
"Parasite": {
  "Whale": "Parasite and Whale have different approaches: Whale aims for clarity and depth, while Parasite often appears diffuse.",
  "Gibbon": "Parasite and Gibbon operate in different communication worlds – subtle versus open."
},
"Whale": {
  "Jackal": "Whale and Jackal may experience tensions, as Whale seeks emotional stability, while Jackal proceeds tactically.",
  "Child": "Whale and Child differ: Whale seeks calm, while the Child brings lively, emotional impulses."
},
"Dinosaur": {
  "Unicorn": "Dinosaur and Unicorn have different approaches: security versus idealistic visions.",
  "Chameleon": "Dinosaur and Chameleon may collide in their methods – stability versus change."
},
"Unicorn": {
  "Hyena": "Unicorn and Hyena have contrasting temperaments – Unicorn lives in visions, while Hyena is goal-oriented.",
  "Rattlesnake": "Unicorn and Rattlesnake may differ in their approach – harmony versus direct impulses."
},
"Oak": {
  "Chameleon": "Oak and Chameleon may clash, as Oak stands for stability, while Chameleon often acts flexibly.",
  "Piranha": "Oak and Piranha have different approaches – deliberate planning versus impulsive action."
},
"Owl": {
  "Hyena": "Owl and Hyena may experience tensions, as the calm Owl prefers deep analysis, while Hyena acts quickly.",
  "Child": "Owl and Child differ: Owl carefully weighs decisions, while the Child acts impulsively."
},
"Rattlesnake": {
  "Whale": "Rattlesnake and Whale may clash, as the direct Rattlesnake can appear challenging, while Whale seeks security.",
  "Child": "Rattlesnake and Child contrast – structured approach versus spontaneous reactions."
},
"Sloth": {
  "Eagle": "Sloth and Eagle have different dynamics – Sloth works calmly, while Eagle strives for higher goals.",
  "Piranha": "Sloth and Piranha operate at different paces – which can lead to tensions."
},
"Vulture": {
  "Chameleon": "Vulture and Chameleon may differ in their planning – structured approaches versus changing strategies.",
  "Child": "Vulture and Child move in different timescales – foresighted versus living in the moment."
},
"Piranha": {
  "Owl": "Piranha and Owl may create tensions, as Piranha makes quick decisions, while Owl analyzes first.",
  "Sloth": "Piranha and Sloth operate at different speeds – leading to mismatched dynamics."
},
"Child": {
  "Eagle": "Child and Eagle may differ in their orientation – impulsive discovery versus structured planning.",
  "Vulture": "Child and Vulture have different priorities – spontaneous versus long-term thinking."
},
"Yak": {
  "Piranha": "Yak is deliberate – Piranha acts impulsively. This different approach can lead to tension.",
  "Child": "Yak values stability, while the Child acts unpredictably – requiring understanding."
},
"Hybrid": {
  "Ant": "Hybrid and Ant differ in their methods – flexible thinking versus clear order.",
  "Yak": "Hybrid and Yak have different focuses – unconventional approaches versus steady endurance."
}
      };

 formElem.addEventListener("submit", function(e) {
  e.preventDefault();

  // 🧠 Schritt 1: attributeData vorbereiten
  attributeData = {}; // ← falls du es ganz oben `let` deklariert hast
  Object.values(tierEigenschaften).flat().forEach(attr => {
    attributeData[attr] = { sum: 0, count: 0 };
  });

  // 1) Einmaliges Holen der Eingaben
  const formData = new FormData(formElem);
  const modus    = document.querySelector('input[name="modus"]:checked').value;  // "selbst" oder "fremd"

  // Bestehende Elemente ausblenden:
  document.querySelector(".logo-container").style.display = "none";
  
  // Falls der Einleitungstext vorhanden ist, ausblenden
  const introTextElem = document.querySelector(".intro-text");
  if (introTextElem) {
    introTextElem.style.display = "none";
  }

// 🧼 Situationsfeld ausblenden (Label + Textarea)
const situationLabel = document.querySelector('label[for="situation"]');
const situationTextarea = document.getElementById('situation');

if (situationLabel) situationLabel.style.display = "none";
if (situationTextarea) situationTextarea.style.display = "none";
  
// Weitere Elemente ausblenden:
document.querySelector("h1").style.display = "none";
document.querySelector(".logo-container").style.display = "none"; // falls noch da
// …
document.querySelectorAll(".user-inputs").forEach(el => el.style.display = "none");

// Formular und Button ausblenden
document.getElementById("fragebogen").style.display     = "none";
document.getElementById("auswertenBtn").style.display  = "none";

  // "Willkommen beim OrganisationsZoo" ausblenden:
  // Wir gehen davon aus, dass der Text in einem <h2> innerhalb eines div mit "text-align: center" steht
  const welcomeElem = document.querySelector("div[style*='text-align: center'] h2");
  if (welcomeElem && welcomeElem.textContent.trim().includes("Willkommen beim OrganisationsZoo")) {
    // Blendet den gesamten Container (das div, in dem das h2 steht) aus
    welcomeElem.parentElement.style.display = "none";
  }

        // Ergebnisbereich und Print-Button sichtbar machen
        ergebnisElem.style.display = "block";
        printButton.style.display = "block";
        ergebnisElem.style.position = "relative";

        // Werte aus den Eingabefeldern übernehmen
        var userName = document.querySelector('input[name="name"]').value;
        var userEmail = document.querySelector('input[name="email"]').value;
const situationText = document.getElementById("situation").value.trim() || "Keine konkrete Situation angegeben";

ergebnisElem.insertAdjacentHTML('afterbegin', `
  <div id="auswertung-start" style="text-align:center; margin-bottom:1rem;">
    <img
      src="eule-organisationszoo.png"
      alt="Eule"
      style="height:120px; width:auto; object-fit:cover;"
    />
  </div>
  <h2 style="
    text-align:center;
    font-size:1.8em;
    margin:0 0 1.5rem;
    font-weight:700;
    color:inherit;
  ">
  Welcome to the <span style="color:#E44A00;">OrganisationsZoo</span>
  </h2>

 <!-- Links: Kontaktdaten -->
    <div id="left-info" style="
      flex: 1;
      font-size: 0.75em;
      color: inherit;
      line-height: 1.4;
    ">
      <div>
        <span style="color:#E44A00; font-weight:700;">
          OrganisationsZoo
        </span>
      </div>
      <div>
        Nicole Stöcker, Peter Renner und Simon Bertogg
      </div>
      <div>
        Murwiesenstrasse 30,&nbsp;
        <span style="white-space:nowrap;">
          8057 Zürich, Schweiz
        </span>
      </div>
      <div>
        Tel: +41 79 634 07 50
      </div>
      <div>
        <a href="mailto:info@organisationszoo.ch" style="color:inherit; text-decoration:none;">
          info@organisationszoo.ch
        </a>
      </div>
      <!-- hier den Abstand einfügen -->
      <div style="height:0.75rem;"></div>

      <div><strong>Name:</strong> ${userName}</div>
      <div><strong>E‑Mail:</strong> ${userEmail}</div>
    </div>
  </div>
`);

requestAnimationFrame(() => {
  const ziel = document.getElementById("auswertung-start");
  if (ziel) {
    ziel.scrollIntoView({ behavior: "smooth", block: "start" });
  } else {
    console.warn("Scrollziel nicht gefunden!");
  }
});

// Reflexionstext erstellen und anhängen
const reflekt = document.createElement('div');
reflekt.classList.add('reflexion-text');
reflekt.style.marginTop = '1.5rem';
reflekt.innerHTML = `
  <h3 style="font-size:1em; color:#E44A00; margin-bottom:0.5rem;">
   What Your Animal Profile Reveals – and Why It's More Than Just Exciting
</h3>
<p>
  Your result is more than just a fun game:
  <strong>It’s a reflection of your current behavioral dynamics</strong>.
  Each animal stands for certain ways of thinking, feeling, and acting –
  <em>and the mix makes you unique</em>.
</p>
<p>
  Maybe within you lies the quiet wisdom of an <strong>Owl</strong>,
  the loyalty of a <strong>Dog</strong>, the strategic instinct of a
  <strong>Hyena</strong>, the vision of an <strong>Eagle</strong>,
  or the creative chaos of a <strong>Gibbon</strong>?
</p>
<p>
  These animal metaphors help you see yourself with a wink and
  at the same time with depth – <strong>without pigeonholing you, but offering space for reflection</strong>.
</p>
<p>
  Curious to explore, question, and develop your profile together with others?
  <strong>Then a workshop is just right for you!</strong>
</p>
<p>
  Because: <em>Personal development should be fun.</em> 
  We often gain the best insights through exchange.
</p>
`;
ergebnisElem.appendChild(reflekt);

const breakAfterReflekt = document.createElement('div');
breakAfterReflekt.className = 'page-break';
ergebnisElem.appendChild(breakAfterReflekt);

// 3) Profil-Titel + Situation unter dem Reflexionstext
ergebnisElem.insertAdjacentHTML('beforeend', `
  <div style="
    text-align:center;
    font-size:1.1em;
    font-weight:bold;
    color:#E44A00;
    line-height:1.3;
    margin-top:2rem;
    margin-bottom:1rem;
  ">
    Your Behavior Profile for the Selected Situation
    <div style="
      font-size:0.85em;
      font-weight:normal;
      color:inherit;
      margin-top:0.25rem;
    ">
      ${situationText}
    </div>
  </div>
`);


// direkt unter dem Insert des Ergebnis-Headers:
 const formData2 = new FormData(formElem);
const tierCounts = {};
// attributeData wurde ja bereits initialisiert weiter oben

// ---------------------------
// Schritt 3: Punkte aus den Antworten sammeln
// ---------------------------
for (let i = 0; i < questions.length; i++) {
  const q = questions[i];
  for (let key in q.answers) {
    const code = q.answers[key].code;
    const wert = parseInt(formData.get(`frage${i}_${code}`)) || 0;
    const tier = codeToTier[code];
    if (!tier) continue;

    // Direkte Punktevergabe für das zugeordnete Tier:
    tierCounts[tier] = (tierCounts[tier] || 0) + wert;

    // Bonuspunkte für ähnliche Tiere – dynamisch gewichtet
    const similarAnimals = similarityMapping[tier] || [];
    similarAnimals.forEach(sim => {
      const similarityBonus = (wert / 4) * 0.5;
      tierCounts[sim.animal] = (tierCounts[sim.animal] || 0) + similarityBonus;
    });

    // Eigenschaften des direkten Tiers dynamisch aufbauen
    if (tierEigenschaften[tier]) {
      tierEigenschaften[tier].forEach(attr => {
        if (!attributeData[attr]) {
          attributeData[attr] = { sum: 0, count: 0 };
        }
        attributeData[attr].sum += wert;
        attributeData[attr].count++;
      });
    }

    // Eigenschaften der ähnlichen Tiere (reduziert gewichtet)
    similarAnimals.forEach(sim => {
      const simTier = sim.animal;
      const similarityBonus = (wert / 4) * 0.5;

      if (tierEigenschaften[simTier]) {
        tierEigenschaften[simTier].forEach(attr => {
          if (!attributeData[attr]) {
            attributeData[attr] = { sum: 0, count: 0 };
          }
          attributeData[attr].sum += similarityBonus;
          attributeData[attr].count++;
        });
      }
    });

const attributePercentages = {};
for (let attr in attributeData) {
  const sum = attributeData[attr].sum;
  const count = attributeData[attr].count;
  attributePercentages[attr] = Math.round((sum / (count * 4)) * 100);
}

    // Gegenspieler-Abzug dynamisch (Schritt 2)
    if (wert > 2) {
      const gegenspielerTier = gegenspieler[tier];
      if (gegenspielerTier) {
        const gegenspielerAbzug = (wert - 2) / 2;
        tierCounts[gegenspielerTier] = (tierCounts[gegenspielerTier] || 0) - gegenspielerAbzug;
      }
    }
  }
}

// Summe aller Punkte (falls benötigt)
const gesamtPunkte = Object.values(tierCounts).reduce((sum, v) => sum + v, 0);

// ---------------------------
// Gesamtauswertung Top-5 Tierprofile
// ---------------------------
ergebnisElem.innerHTML += `<h2>"Your Animal Behavior Patterns"</h2>`;
const sortedTiers = Object.entries(tierCounts).sort((a, b) => b[1] - a[1]);
const top5 = sortedTiers.slice(0, 5);

// Nur noch einmal den Wrapper mit deiner Css‑Klasse erzeugen:
const chartWrap = document.createElement("div");
chartWrap.className = "chartWrap";

const maxPunkte = 25;

top5.forEach(([tier, val]) => {
  const fileName = makeFileName(tier);
  const canvasId = `tierChart_${fileName}`;

  const div = document.createElement("div");
  div.className = "tier-profil";
  div.innerHTML = `
    <div class="tier-bild">
      <img src="${fileName}.png" alt="${tier}" />
    </div>
    <div class="tier-text">
      <strong>${tier}</strong>
      <p>${(tierTexte[tier] || {}).kurz || ''}</p>
      <span>Symbolisch für: ${(tierTexte[tier] || {}).symbolischFür || '-'}</span>
    </div>
    <div class="tier-diagramm">
      <canvas id="${canvasId}" width="80" height="80"></canvas>
    </div>
  `;

  chartWrap.appendChild(div);

  setTimeout(() => {
    new Chart(
      document.getElementById(canvasId).getContext("2d"),
      {
        type: 'pie',
        data: {
          labels: ["Erreichte Punkte", "Fehlende Punkte"],
          datasets: [{
            data: [val, maxPunkte - val],
            backgroundColor: ["#E44A00", "#FFD1B2"],
            borderWidth: 0
          }]
        },
        options: {
          responsive: false,
          plugins: { legend: { display: false } }
        }
      }
    );
  }, 10);
});

ergebnisElem.appendChild(chartWrap);

       // Annahme: 
// top5 ist ein Array von Arrays, z.B.: [ [ "Hund", 10 ], [ "Katze", 8 ], ... ]
// tierKonflikte ist ein Objekt, in dem du für jedes Tier (Schlüssel) ein Objekt mit Konfliktpartnern und Konflikttexten hast, z.B.:
// {
//    Hund: { Maus: "Hund jagt Maus.", Fuchs: "Hund vs Fuchs." },
//    Katze: { Hund: "Katze hat Angst vor Hund.", Maus: "Katze jagt Maus." },
//    ...
// }

const myAnimals = top5.map(item => item[0]); // Deine Top 5

// Erstelle ein Aggregationsobjekt, um Konfliktpunkte für Tiere (ausserhalb der Top‑5) zu sammeln.
const conflictAggregation = {};
// Speichere zu jedem Konfliktpartner den (ersten) Konflikttext
const conflictTextAggregation = {};

// Für jedes deiner Tiere, durchlaufe den Konfliktbaum:
myAnimals.forEach(myTier => {
  if (tierKonflikte[myTier]) {
    Object.entries(tierKonflikte[myTier]).forEach(([opponent, text]) => {
      // Nur Konflikte berücksichtigen, deren Gegner NICHT in den Top‑5 sind.
      if (!myAnimals.includes(opponent)) {
        // Erhöhe die Konfliktpunkte (hier rein als 1-Zähler, alternativ könntest du auch mit Gewichtung arbeiten)
        conflictAggregation[opponent] = (conflictAggregation[opponent] || 0) + 1;
        // Falls noch kein Text für diesen Gegner gespeichert wurde, speichere ihn
        if (!conflictTextAggregation[opponent]) {
          conflictTextAggregation[opponent] = text;
        }
      }
    });
  }
});

// Jetzt hast du z. B. conflictAggregation = { "Tiger": 3, "Elefant": 2, ... }

// Konvertiere das Aggregat in ein Array und sortiere absteigend nach Konfliktpunkten:
const sortedOpponents = Object.entries(conflictAggregation)
  .sort(([, countA], [, countB]) => countB - countA);

// Jetzt wähle die beiden Konfliktpartner mit den meisten Punkten aus:
if (sortedOpponents.length > 0) {
  const opponent1 = sortedOpponents[0][0];
  // Falls es mindestens zwei Gegner gibt, nehme den zweiten; ansonsten nur den ersten.
  const opponent2 = sortedOpponents.length > 1 ? sortedOpponents[1][0] : null;
  
  // Erstelle den Header:
  let conflictHeader = document.createElement("div");
  conflictHeader.innerHTML = "<h2 style='font-size: 1.5em;'>„Where tensions arise in the enclosure...“</h2>";
  ergebnisElem.appendChild(conflictHeader);

  // Erstelle den Container für die Konfliktpartner:
  const conflictDiv = document.createElement("div");
  conflictDiv.className = "tier-konflikt-container";

  // Erstelle HTML für den ersten Gegner:
  let conflictHTML = `
    <div class="tier-container">
      <div class="tier-bild">
        <img src="${opponent1.toLowerCase()}.png" alt="${opponent1}" />
      </div>
      <div class="tier-text">
        <strong>${opponent1}</strong>
        <p>${conflictTextAggregation[opponent1] || ""}</p>
      </div>
    </div>
  `;

  // Falls ein zweiter Gegner existiert, füge ihn hinzu:
  if (opponent2) {
    conflictHTML += `
      <div class="tier-container">
        <div class="tier-bild">
          <img src="${opponent2.toLowerCase()}.png" alt="${opponent2}" />
        </div>
        <div class="tier-text">
          <strong>${opponent2}</strong>
          <p>${conflictTextAggregation[opponent2] || ""}</p>
        </div>
      </div>
    `;
  }

  conflictDiv.innerHTML = conflictHTML;
  ergebnisElem.appendChild(conflictDiv);

const breakAfterGehege = document.createElement("div");
breakAfterGehege.className = "page-break";
ergebnisElem.appendChild(breakAfterGehege);
  
} else {
  // Wenn keine Konflikte gefunden wurden:
  let conflictHeader = document.createElement("div");
  conflictHeader.innerHTML = "<h2 style='font-size: 1.5em;'>Keine Konflikte erkannt.</h2>";
  ergebnisElem.appendChild(conflictHeader);
}

// ---------------------------
// Darstellung Top‑5‑Tiere pro Kategorie in Containern
// ---------------------------

// Farben & Layout
const containerStyle = `
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #f7f7f7;
  border-radius: 12px;
  padding: 16px 24px;
  margin-bottom: 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
`;
const tierStyle = `
  flex: 1;
  font-weight: bold;
  font-size: 1.1em;
`;
const categoryStyle = `
  flex: 1;
  text-align: center;
  font-weight: 600;
  font-size: 1em;
  color: #444;
`;
const beschreibungStyle = `
  flex: 2;
  font-size: 0.95em;
  color: #333;
  text-align: left;
`;


// Mapping: Kategorie → relevante Frageindizes (Freizeit)
const kategorienMapping = {
"Group Activities & Collaboration": [0, 1, 9],
"Leadership & Responsibility": [6, 7, 12],
"Activity Planning & Organization": [5, 10],
"Adaptability & Stress Management": [3, 11],
"Self-Development & Personal Growth": [2, 4, 8]
};

// Tier-Beschreibungen je Kategorie (Freizeit)
const categoryDescriptions = {
  "Group Activities & Collaboration": {
  "Ant": "Organized and goal-oriented, provides structure within the group.",
  "Bee": "Hardworking and community-driven, strengthens cohesion.",
  "Chameleon": "Flexible and creative, brings new ideas to activities.",
  "Dog": "Empathetic and loyal, fosters togetherness.",
  "Eagle": "Can inspire, but tends toward individualism.",
  "Cat": "Independent and critical, questions group decisions.",
  "Gibbon": "Communicative and moderating, ensures good exchange.",
  "Hyena": "Dominant and assertive, establishes clear roles.",
  "Useful_Insect": "Supportive and inventive, solution-oriented thinker.",
  "Annoying_Insect": "Selfish and restless, can cause disturbances.",
  "Jackal": "Rebellious and headstrong, brings tension to the group.",
  "Lion": "Strong leader, gladly takes charge.",
  "Mouse": "Quiet and cautious, works reliably in the background.",
  "Parasite": "Takes advantage of the group without contributing much.",
  "Owl": "Far-sighted and wise, provides profound insights.",
  "Piranha": "Goal-oriented but aggressive in group settings.",
  "Oak": "Steadfast and stabilizing, provides security.",
  "Rattlesnake": "Tactical and calculating, pursues own goals.",
  "Sloth": "Patient and calm, soothes hectic moods.",
  "Dinosaur": "Experienced but often sluggish in new environments.",
  "Unicorn": "Visionary and idealistic, inspires others.",
  "Vulture": "Observes a lot but rarely intervenes actively.",
  "Whale": "Emotionally deep and trustworthy, encourages openness.",
  "Hybrid": "Intelligent and analytical, focused on efficiency.",
  "Yak": "Robust and loyal, reliably supports the group.",
  "Child": "Enthusiastic and creative, sometimes needs guidance."
},
"Leadership & Responsibility": {
  "Eagle": "Natural leader, visionary and determined.",
  "Hybrid": "Versatile in leadership, combines strategy with flexibility.",
  "Lion": "Dominant and charismatic, gladly assumes command.",
  "Dog": "Responsible and cooperative.",
  "Ant": "Organized in the collective – takes responsibility for the group.",
  "Bee": "Conscientious and committed, contributes greatly to success.",
  "Chameleon": "Leads indirectly, adapts to the group.",
  "Cat": "Self-reliant, avoids formal leadership roles.",
  "Gibbon": "Supportive and dialogue-oriented – leads through communication.",
  "Hyena": "Assertive and controlling.",
  "Useful_Insect": "Helps in the background, assumes responsibility without spotlight.",
  "Annoying_Insect": "Reluctant to take responsibility, often disruptive.",
  "Jackal": "Rebellious – assumes responsibility on own terms.",
  "Mouse": "Hesitant, steps up only when feeling secure.",
  "Parasite": "Avoids responsibility, prefers to act unnoticed.",
  "Owl": "Wise and strategic – leads through informed decisions.",
  "Piranha": "Dominant, enforces decisions quickly.",
  "Oak": "Stable and constant – a calming force in leadership roles.",
  "Rattlesnake": "Tactical and hidden – leads calculatingly.",
  "Sloth": "Too laid-back for traditional leadership roles.",
  "Dinosaur": "Traditional, leads through experience.",
  "Unicorn": "Inspiring, sometimes too idealistic for clear leadership.",
  "Vulture": "Waits before assuming responsibility.",
  "Whale": "Trustworthy and caring in leadership tasks.",
  "Yak": "Reliable and strong – leads through consistency.",
  "Child": "Takes initiative spontaneously but without long-term planning."
},
"Activity Planning & Organization": {
  "Gibbon": "Creative and thoughtful, plans diverse activities.",
  "Unicorn": "Visionary and innovative in concept development.",
  "Eagle": "Structured and goal-oriented in planning.",
  "Ant": "Methodical and organized.",
  "Bee": "Pragmatic, focused on efficiency.",
  "Chameleon": "Flexible, adapts plans spontaneously.",
  "Dog": "Trusts intuition and group mood.",
  "Lion": "Decisive, implements plans quickly.",
  "Cat": "Analytical and precise in preparation.",
  "Hyena": "Strategic long-term, keeps goals in view.",
  "Useful_Insect": "Unconventionally creative.",
  "Annoying_Insect": "Impulsive, lacks structure.",
  "Jackal": "Spontaneous and headstrong.",
  "Mouse": "Cautious, weighs everything carefully.",
  "Parasite": "Adapts without planning independently.",
  "Owl": "Profound and sustainable in concept work.",
  "Piranha": "Impulsive, plans under pressure.",
  "Oak": "Foresighted and stable.",
  "Rattlesnake": "Tactical and covert.",
  "Sloth": "Slow, needs much time.",
  "Dinosaur": "Traditional, avoids innovation.",
  "Vulture": "Waits and decides at the optimal time.",
  "Whale": "Value-oriented and intuitive.",
  "Hybrid": "Analytical and flexible.",
  "Yak": "Practical and steadfast.",
  "Child": "Spontaneous and experimental."
},
"Adaptability & Stress Management": {
  "Ant": "Stays organized even under stress.",
  "Bee": "Responds collectively and in a structured way.",
  "Chameleon": "Adapts playfully to any situation.",
  "Dog": "Seeks emotional support for balance.",
  "Eagle": "Observes calmly and makes clear decisions.",
  "Cat": "Withdraws, solves problems independently.",
  "Gibbon": "Open in conversation, finds balance through dialogue.",
  "Hyena": "Impulsive, fights through with energy.",
  "Useful_Insect": "Pragmatic and inventive.",
  "Annoying_Insect": "Amplifies restlessness in the environment.",
  "Jackal": "Rebels under pressure.",
  "Lion": "Dominant and controlled.",
  "Mouse": "Cautious and reserved.",
  "Parasite": "Avoids stressful situations.",
  "Owl": "Analyzes and remains calm.",
  "Piranha": "Aggressive and fast.",
  "Oak": "Steadfast and calm.",
  "Rattlesnake": "Defensive and calculated.",
  "Sloth": "Calm, lets stress pass by.",
  "Dinosaur": "Struggles with change.",
  "Unicorn": "Seeks creative ways out, but may be overwhelmed.",
  "Vulture": "Adapts slowly.",
  "Whale": "Emotional depth helps to stay calm.",
  "Hybrid": "Flexible and quick in reaction.",
  "Yak": "Resilient and enduring.",
  "Child": "Responds curiously, processes stress playfully."
},
"Self-Development & Personal Growth": {
  "Ant": "Structured and continuous in self-work.",
  "Bee": "Open to feedback, strives for improvement.",
  "Cat": "Self-critical and independent.",
  "Gibbon": "Creative and communicative in reflection.",
  "Owl": "Analytical and profound.",
  "Eagle": "Goal-oriented through challenges.",
  "Chameleon": "Reflects situationally.",
  "Dog": "Learns through relationships.",
  "Lion": "Power- and status-oriented.",
  "Hyena": "Ambitious and strategic.",
  "Useful_Insect": "Eager to learn through practical doing.",
  "Annoying_Insect": "Little introspection.",
  "Jackal": "Rebellious with drive.",
  "Mouse": "Reserved but profound.",
  "Parasite": "Develops out of necessity.",
  "Piranha": "Little interest in inner work.",
  "Oak": "Steady and value-based.",
  "Rattlesnake": "Calculating in development.",
  "Sloth": "Calm and patient.",
  "Dinosaur": "Slow, tradition-oriented.",
  "Unicorn": "Idealistic and meaning-oriented.",
  "Vulture": "Reflects more about others.",
  "Whale": "Deeply emotional and holistic.",
  "Hybrid": "Introspective and versatile.",
  "Yak": "Down-to-earth and experience-based.",
  "Child": "Curious and playful in learning."
  }
};

// ––––––––––––––––––––––––––––––––––––––––––––––––––––
// 1) Mapping: Bei welchen Fragen taucht jedes Top‑5‑Tier auf?
// ––––––––––––––––––––––––––––––––––––––––––––––––––––
const tierZuKategorie = {};
questions.forEach((q, i) => {
  Object.values(q.answers).forEach(ans => {
    const tier = codeToTier[ans.code];
    if (tier && top5.some(([name]) => name === tier)) {
      (tierZuKategorie[tier] ||= []).push(i);
    }
  });
});

const headingWrapper = document.createElement("div");
headingWrapper.style.maxWidth = "800px";
headingWrapper.style.margin = "40px auto 30px";
headingWrapper.style.padding = "0 16px";
headingWrapper.style.display = "flex";
headingWrapper.style.flexDirection = "column";
headingWrapper.style.gap = "12px";

// 1. Haupttitel: Instincts, Intuition & Influence
const subtitle = document.createElement("h2");
subtitle.textContent = "Instinkte, Intuition & Einfluss";
subtitle.style.fontSize = "1.6em";
subtitle.style.fontWeight = "700";
subtitle.style.margin = "0";
subtitle.style.color = "inherit"; // Standardfarbe (dunkel im Light Mode, hell im Dark Mode)
subtitle.style.textAlign = "left";
headingWrapper.appendChild(subtitle);

// 2. Erklärungstext
const erklaerung = document.createElement("p");
erklaerung.textContent = "This overview shows how your character tendencies express themselves in different situations – without putting you in a box, but with a wink."
erklaerung.style.fontSize = "0.95em";
erklaerung.style.lineHeight = "1.6";
erklaerung.style.margin = "0";
erklaerung.style.textAlign = "left";
erklaerung.style.color = "inherit";
headingWrapper.appendChild(erklaerung);

// 3. Zweite Hauptzeile: "Your Behavior Map"
const verhaltensTitel = document.createElement("h2");
verhaltensTitel.textContent = "„Your Behavior Map“";
verhaltensTitel.style.fontSize = "1.6em";
verhaltensTitel.style.fontWeight = "700";
verhaltensTitel.style.margin = "24px 0 0";
verhaltensTitel.style.color = "inherit";
verhaltensTitel.style.textAlign = "left";
headingWrapper.appendChild(verhaltensTitel);

// In Ergebnis einfügen
ergebnisElem.appendChild(headingWrapper);

Object.keys(kategorienMapping).forEach(kat => {
  const relevanteFragen = kategorienMapping[kat];
  const counts = {};
  Object.entries(tierZuKategorie).forEach(([tier, fragen]) => {
    const c = fragen.filter(i => relevanteFragen.includes(i)).length;
    if (c > 0) counts[tier] = c;
  });

  const topTier = Object.entries(counts).sort((a, b) => b[1] - a[1])[0]?.[0] || top5[0][0];
  const beschreibung = categoryDescriptions[kat]?.[topTier] || 'Hier erfährst du mehr über dieses Tier.';
  const fileName = makeFileName(topTier);

  // Gesamtcontainer
  const section = document.createElement('div');
  section.style.cssText = `
    display: flex;
    align-items: flex-start;
    gap: 20px;
    padding: 20px;
    background-color: var(--bg-card, #fff);
    color: var(--text-color, #000);
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin: 20px 0;
    transition: background 0.3s, color 0.3s;
    flex-wrap: wrap;
  `;

  // Bild links
  const imageDiv = document.createElement('div');
  imageDiv.style.cssText = `
    flex: 0 0 auto;
    width: 60px;
    height: 60px;
  `;
  imageDiv.innerHTML = `<img src="${fileName}.png" alt="${topTier}" style="width:100%; height:auto;">`;
  section.appendChild(imageDiv);

  // Textblock rechts (mittig stacked)
  const textWrapper = document.createElement('div');
  textWrapper.style.cssText = `
    flex: 1 1 300px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  `;

  const titleEl = document.createElement('div');
  titleEl.style.cssText = `
    font-size: 1.1em;
    font-weight: bold;
    margin-bottom: 6px;
  `;
  titleEl.textContent = kat;

  const descEl = document.createElement('div');
  descEl.style.cssText = `
    font-size: 0.95em;
    line-height: 1.5;
    color: inherit;
  `;
  descEl.innerHTML = beschreibung;

  textWrapper.appendChild(titleEl);
  textWrapper.appendChild(descEl);
  section.appendChild(textWrapper);

  ergebnisElem.appendChild(section);
});

// Seitenumbruch nach allen Verhaltenskategorien
const breakNachKarte = document.createElement("div");
breakNachKarte.className = "page-break";
ergebnisElem.appendChild(breakNachKarte);

// ---------------------------
// Berechne die Prozentwerte für jedes Attribut
// ---------------------------
const attributePercentages = {};
for (let attr in attributeData) {
  const sum   = attributeData[attr].sum;
  const count = attributeData[attr].count;
  // 4 = Maximalwertung pro Frage
  attributePercentages[attr] = Math.round((sum / (count * 4)) * 100);
}

// Optional: zum Debuggen
console.log("attributePercentages:", attributePercentages);

// ---------------------------
// Netzdiagramm anzeigen
// ---------------------------

// Werte vorbereiten
const attributeLabels = Object.keys(attributePercentages);
const attributeValues = Object.values(attributePercentages);

// ---------------------------
// Titel & Beschreibung für Selbstreflexion
// ---------------------------
const reflexionWrapper = document.createElement("div");
reflexionWrapper.style.maxWidth = "800px";
reflexionWrapper.style.margin = "60px auto 30px";
reflexionWrapper.style.textAlign = "center";

const reflexionTitle = document.createElement("h2");
reflexionTitle.textContent = "Your Personal Profile at a Glance";
reflexionTitle.style.fontSize = "1.8em";
reflexionTitle.style.marginBottom = "12px";

const reflexionText = document.createElement("p");
reflexionText.textContent =
 "This diagram shows how strongly certain traits appear in your overall profile – based on your answers. It is a snapshot of your reflection on yourself."
reflexionText.style.fontSize = "0.95em";
reflexionText.classList.add("reflexion-text");
reflexionText.style.lineHeight = "1.6";

reflexionWrapper.appendChild(reflexionTitle);
reflexionWrapper.appendChild(reflexionText);
ergebnisElem.appendChild(reflexionWrapper);

// Canvas in zentriertem Container einfügen
const canvasWrapper = document.createElement("div");
canvasWrapper.style.display = "flex";
canvasWrapper.style.justifyContent = "center";
canvasWrapper.style.alignItems = "center";
canvasWrapper.style.marginBottom = "40px";

const canvas = document.createElement("canvas");
const size = 400;
const scale = 2;
canvas.width = size * scale;
canvas.height = size * scale;
canvas.style.width = size + "px";
canvas.style.height = size + "px";

canvasWrapper.appendChild(canvas);
ergebnisElem.appendChild(canvasWrapper);

// Context holen und skalieren
const ctx = canvas.getContext("2d");
ctx.scale(scale, scale);

// Dynamisches Maximum
const maxEigenschaftswert = Math.max(...attributeValues);
const dynamicMax = Math.ceil(maxEigenschaftswert * 1.2);

// Dark Mode Farben setzen
const darkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
const pointLabelColor = darkMode ? "#ffffff" : "#000000";
const gridColor = darkMode ? "#555555" : "#eee";

// Nur wenn Werte vorhanden sind
if (attributeLabels.length > 0) {
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: attributeLabels,
      datasets: [{
        label: "Dein Profil",
        data: attributeValues,
        backgroundColor: "rgba(228, 74, 0, 0.3)",
        borderColor: "#E44A00",
        pointBackgroundColor: "#E44A00",
        borderWidth: 2
      }]
    },
    options: {
      responsive: false,
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: dynamicMax,
          ticks: {
            stepSize: 20,
            backdropColor: "transparent",
            font: { size: 12 }
          },
          pointLabels: {
            font: { size: 28 },
            color: pointLabelColor
          },
          grid: { color: gridColor },
          angleLines: { color: "#ccc" }
        }
      },
      plugins: {
        legend: { display: false }
   }
        }
      });
    } // Ende der if‑Abfrage

formElem.addEventListener("submit", function(e) {
  e.preventDefault();

  // … ALLES, was die Ergebnisse aufbaut und #auswertung-start injiziert …

  // Ergebnis und Print-Button zeigen
  ergebnisElem.style.display = "block";
  printButton.style.display = "block";

  setTimeout(() => {
  const ziel = document.getElementById("auswertung-start");
  if (ziel) {
    ziel.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}, 0); // oder 50–100ms

}); // 
  }); // ← schließt formElem.addEventListener("submit", …)


  // 🧠 E-Mail prüfen, Button nur aktivieren bei gültiger Adresse
  const emailInput   = document.getElementById("email");
  const auswertenBtn = document.getElementById("auswertenBtn");
  emailInput.addEventListener("input", () => {
    const emailWert  = emailInput.value.trim();
    const istGueltig = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailWert);
    auswertenBtn.disabled = !istGueltig;
  });

  // 🖨 Druck-Button: Löst window.print() aus
  printButton.addEventListener("click", () => window.print());

}); // ← schliesst document.addEventListener("DOMContentLoaded", …)
</script>

  <!-- Footer nur beim Drucken sichtbar – direkt vor </body> -->
  <div class="print-footer">
    © 2025 <span style="color: #E44A00;">OrganisationsZoo</span> Nicole Stöcker, Peter Renner und Simon Bertogg - Alle Rechte vorbehalten.
  </div>
</body>
</html>
